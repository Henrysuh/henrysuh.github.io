<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>전통시장 지도</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #map { width: 100%; height: 600px; margin-top: 20px; }
  </style>
  <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h64ukxd2fc"></script>
</head>
<body>

<h2>전통시장 마커 지도</h2>
<p>CSV 자동 로딩 (<code>traditional_market.csv</code>)</p>
<div id="map"></div>

<script>
  const map = new naver.maps.Map('map', {
    center: new naver.maps.LatLng(36.5, 127.8), // 대한민국 중심
    zoom: 7
  });

  function parseCSV(text) {
    const lines = text.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim());
    return lines.slice(1).map(line => {
      const values = line.split(',').map(v => v.trim());
      return Object.fromEntries(values.map((v, i) => [headers[i], v]));
    });
  }

  fetch("traditional_market.csv")
    .then(response => response.text())
    .then(csv => {
      const data = parseCSV(csv);
      const bounds = new naver.maps.LatLngBounds();

      data.forEach(item => {
        const lat = parseFloat(item['위도']);
        const lng = parseFloat(item['경도']);
        if (isNaN(lat) || isNaN(lng)) return;

        const position = new naver.maps.LatLng(lat, lng);

        const marker = new naver.maps.Marker({
          position,
          map,
          title: item['시장명']
        });

        const infoWindow = new naver.maps.InfoWindow({
          content: `
            <div style="padding:10px; font-size:13px;">
              <strong>${item['시장명']}</strong><br>
              유형: ${item['시장유형']}<br>
              개설연도: ${item['개설연도']}<br>
              점포 수: ${item['점포수']}개<br>
              공중화장실: ${item['공중화장실 보유']}<br>
              주차장: ${item['주차장 보유']}
            </div>
          `
        });

        naver.maps.Event.addListener(marker, 'click', () => {
          infoWindow.open(map, marker);
        });

        bounds.extend(position);
      });

      map.fitBounds(bounds);
    });
</script>

</body>
</html>
