<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì „í†µì‹œì¥ ì§€ë„</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #map { width: 100%; height: 600px; margin-top: 20px; }
  </style>
  <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=h64ukxd2fc"></script>
</head>
<body>

<h2>ì „í†µì‹œì¥ ë§ˆì»¤ ì§€ë„ + ë‚´ ìœ„ì¹˜ í‘œì‹œ</h2>
<p>CSV ìë™ ë¡œë”© (<code>traditional_market.csv</code>)<br>
ğŸ“ ë¸Œë¼ìš°ì €ì—ì„œ í˜„ì¬ ìœ„ì¹˜ë¥¼ í—ˆìš©í•˜ë©´, ì§€ë„ ì¤‘ì‹¬ì´ ìë™ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
<div id="map"></div>

<script>
  const map = new naver.maps.Map('map', {
    center: new naver.maps.LatLng(36.5, 127.8),
    zoom: 7
  });

  function parseCSV(text) {
    const lines = text.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim());
    return lines.slice(1).map(line => {
      const values = line.split(',').map(v => v.trim());
      return Object.fromEntries(values.map((v, i) => [headers[i], v]));
    });
  }

  fetch("traditional_market.csv")
    .then(response => response.text())
    .then(csv => {
      const data = parseCSV(csv);
      const bounds = new naver.maps.LatLngBounds();

      data.forEach(item => {
        const lat = parseFloat(item['ìœ„ë„']);
        const lng = parseFloat(item['ê²½ë„']);
        if (isNaN(lat) || isNaN(lng)) return;

        const position = new naver.maps.LatLng(lat, lng);

        const marker = new naver.maps.Marker({
          position,
          map,
          title: item['ì‹œì¥ëª…']
        });

        const infoWindow = new naver.maps.InfoWindow({
          content: `
            <div style="padding:10px; font-size:13px;">
              <strong>${item['ì‹œì¥ëª…']}</strong><br>
              ìœ í˜•: ${item['ì‹œì¥ìœ í˜•']}<br>
              ê°œì„¤ì—°ë„: ${item['ê°œì„¤ì—°ë„']}<br>
              ì í¬ ìˆ˜: ${item['ì í¬ìˆ˜']}ê°œ<br>
              ê³µì¤‘í™”ì¥ì‹¤: ${item['ê³µì¤‘í™”ì¥ì‹¤ ë³´ìœ ']}<br>
              ì£¼ì°¨ì¥: ${item['ì£¼ì°¨ì¥ ë³´ìœ ']}
            </div>
          `
        });

        naver.maps.Event.addListener(marker, 'click', () => {
          infoWindow.open(map, marker);
        });

        bounds.extend(position);
      });

      map.fitBounds(bounds);
    });

  // âœ… ë‚´ ìœ„ì¹˜ í‘œì‹œ ê¸°ëŠ¥ ì¶”ê°€
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function(position) {
        const userLat = position.coords.latitude;
        const userLng = position.coords.longitude;
        const userLocation = new naver.maps.LatLng(userLat, userLng);

        new naver.maps.Marker({
          position: userLocation,
          map: map,
          icon: {
            content: '<div style="background:#1976D2;border-radius:50%;width:12px;height:12px;"></div>',
            size: new naver.maps.Size(12, 12),
            anchor: new naver.maps.Point(6, 6)
          },
          title: "ë‚´ ìœ„ì¹˜"
        });

        map.setCenter(userLocation);
        map.setZoom(13);
      },
      function(error) {
        console.warn("ğŸ“ ìœ„ì¹˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", error.message);
      }
    );
  } else {
    alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
  }
</script>

</body>
</html>
